<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAN Diagnostic Emulator</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .console, .status-container {
            width: 50%;
            margin: auto;
            background: black;
            color: lime;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            text-align: left;
            border: 1px solid white;
        }
        .dashboard { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
        .control { display: flex; flex-direction: column; align-items: center; }
        .input-container { margin: 20px; }
        .input-container input { width: 50%; padding: 5px; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        .status-container { margin-top: 20px; text-align: center; }
        .status { display: flex; justify-content: space-around; padding: 5px; }
        .status div { padding: 10px; border: 1px solid white; border-radius: 5px; min-width: 120px; }
        .on { background: green; color: white; }
        .off { background: red; color: white; }
        .description { margin-top: 20px; text-align: left; width: 50%; margin-left: auto; margin-right: auto; }
    </style>
</head>
<body>

    <h2>CAN Diagnostic Emulator</h2>

    <div class="input-container">
        <input type="text" id="commandInput" placeholder="Enter AT command (e.g., AT+RDI=0123)" onkeydown="if(event.key==='Enter') sendCommand()">
        <button onclick="sendCommand()">Send</button>
    </div>

    <div class="console" id="consoleLog"></div>

    <h3>ECU & Engine Status</h3>
    <div class="status-container">
        <div class="status">
            <div id="ignitionStatus" class="off">Ignition: OFF</div>
            <div id="engineStatus" class="off">Engine: OFF</div>
        </div>
    </div>

    <h3>Vehicle Dashboard</h3>
    <div class="dashboard">
        <div class="control">
            <label>Speed (km/h): <span id="speedValue">0</span></label>
            <input type="range" id="speed" min="0" max="200" value="0" oninput="updateValue('speed')">
        </div>
        <div class="control">
            <label>RPM: <span id="rpmValue">0</span></label>
            <input type="range" id="rpm" min="0" max="8000" value="0" oninput="updateValue('rpm')">
        </div>
        <div class="control">
            <label>Brake: <span id="brakeValue">0</span></label>
            <input type="range" id="brake" min="0" max="100" value="0" oninput="updateValue('brake')">
        </div>
        <div class="control">
            <label>Gas Pedal: <span id="gasValue">0</span></label>
            <input type="range" id="gas" min="0" max="100" value="0" oninput="updateValue('gas')">
        </div>
    </div>

    <h3>Command Descriptions</h3>
    <div class="description">
        <p><strong>AT+PWRON</strong>: Powers on the ECU. Expected CAN Request: <code>0x10 01</code>, Response: <code>0x50 01</code></p>
        <p><strong>AT+ENGINEON</strong>: Starts the engine (Requires ECU ON). Expected CAN Request: <code>0x10 03</code>, Response: <code>0x50 03</code></p>
        <p><strong>AT+RDI=0123</strong>: Read Speed & RPM. Expected CAN Request: <code>0x22 0123</code>, Response: <code>0x62 0123 [Speed] [RPM]</code></p>
        <p><strong>AT+RDI=0456</strong>: Read Brake & Gas. Expected CAN Request: <code>0x22 0456</code>, Response: <code>0x62 0456 [Brake] [Gas]</code></p>
        <p><strong>AT+RDI=0789</strong>: Read Ignition & Engine Status. Expected CAN Request: <code>0x22 0789</code>, Response: <code>0x62 0789 [Ignition] [Engine]</code></p>
        <p>Negative Responses: If the ECU or Engine is off, response will be <code>0x7F 22 [Error Code]</code>.</p>
    </div>

    <script>
        let ecuPoweredOn = false;
        let engineOn = false;

        function logMessage(message) {
            let log = document.getElementById("consoleLog");
            log.innerHTML += message + "<br>";
            log.scrollTop = log.scrollHeight;
        }

        function updateValue(id) {
            document.getElementById(id + "Value").innerText = document.getElementById(id).value;
        }

        function sendCommand() {
            let input = document.getElementById("commandInput").value.trim();
            if (!input) return;

            logMessage("> " + input);
            let response = processATCommand(input);
            logMessage(response);
            document.getElementById("commandInput").value = "";
        }

        function processATCommand(command) {
            if (command === "AT+PWRON") {
                ecuPoweredOn = true;
                document.getElementById("ignitionStatus").classList.add("on");
                document.getElementById("ignitionStatus").classList.remove("off");
                document.getElementById("ignitionStatus").innerText = "Ignition: ON";
                return "CAN [0x10 01] → Response: 0x50 01";
            }

            if (command === "AT+ENGINEON") {
                if (!ecuPoweredOn) return "ERROR: ECU must be powered on first!";
                engineOn = true;
                document.getElementById("engineStatus").classList.add("on");
                document.getElementById("engineStatus").classList.remove("off");
                document.getElementById("engineStatus").innerText = "Engine: ON";
                return "CAN [0x10 03] → Response: 0x50 03";
            }

            if (command.startsWith("AT+RDI=")) {
                if (!ecuPoweredOn) return "ERROR: ECU is OFF! Response: 0x7F 22 11";
                if (!engineOn) return "ERROR: Engine is OFF! Response: 0x7F 22 33";

                let identifier = command.split("=")[1];
                switch (identifier) {
                    case "0123":
                        return `CAN [0x22 0123] → Response: 0x62 0123 ${getHex("speed")} ${getHex("rpm")}`;
                    case "0456":
                        return `CAN [0x22 0456] → Response: 0x62 0456 ${getHex("brake")} ${getHex("gas")}`;
                    case "0789":
                        return `CAN [0x22 0789] → Response: 0x62 0789 ${ecuPoweredOn ? "01" : "00"} ${engineOn ? "01" : "00"}`;
                    default:
                        return `ERROR: Unknown RDI Identifier! Response: 0x7F 22 12`;
                }
            }

            return "ERROR: Unknown command!";
        }

        function getHex(id) {
            return Number(document.getElementById(id).value).toString(16).padStart(2, '0').toUpperCase();
        }
    </script>

</body>
</html>